{% extends 'base.html' %}

{% block title %}Profil de {{ employee.get_full_name }}{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">
                <i class="fas fa-user me-2 text-primary"></i>Profil employé
            </h1>
            <p class="text-muted mb-0">Informations détaillées de {{ employee.get_full_name }}</p>
        </div>
        <a href="{% url 'accounts:employee_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Retour à la liste
        </a>
    </div>

    <div class="row">
        <!-- Informations principales -->
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-user me-2"></i>Informations personnelles
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Nom complet :</strong>
                            <div class="text-gray-800">{{ employee.get_full_name }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Nom d'utilisateur :</strong>
                            <div class="text-gray-800">{{ employee.username }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Email :</strong>
                            <div class="text-gray-800">
                                <a href="mailto:{{ employee.email }}">{{ employee.email }}</a>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Téléphone :</strong>
                            <div class="text-gray-800">
                                {% if employee.phone %}
                                    <a href="tel:{{ employee.phone }}">{{ employee.phone }}</a>
                                {% else %}
                                    <span class="text-muted">Non renseigné</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-12 mb-3">
                            <strong class="text-primary">Adresse :</strong>
                            <div class="text-gray-800">
                                {% if employee.address %}
                                    {{ employee.address|linebreaks }}
                                {% else %}
                                    <span class="text-muted">Non renseignée</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-briefcase me-2"></i>Informations professionnelles
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Rôle :</strong>
                            <div>
                                <span class="{{ employee.role_badge_class }}">
                                    {{ employee.get_role_display }}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Statut :</strong>
                            <div>
                                {% if employee.is_active %}
                                    <span class="badge bg-success">Actif</span>
                                {% else %}
                                    <span class="badge bg-secondary">Inactif</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Date d'embauche :</strong>
                            <div class="text-gray-800">
                                {% if employee.hire_date %}
                                    {{ employee.hire_date|date:"d/m/Y" }}
                                {% else %}
                                    <span class="text-muted">Non renseignée</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Membre depuis :</strong>
                            <div class="text-gray-800">{{ employee.date_joined|date:"d/m/Y" }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-primary">Dernière connexion :</strong>
                            <div class="text-gray-800">
                                {% if employee.last_login %}
                                    {{ employee.last_login|date:"d/m/Y H:i" }}
                                {% else %}
                                    <span class="text-muted">Jamais connecté</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-cogs me-2"></i>Actions
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'accounts:employee_edit' employee.pk %}" class="btn btn-warning">
                            <i class="fas fa-edit me-2"></i>Modifier
                        </a>
                        {% if employee.is_active %}
                            <button class="btn btn-secondary" onclick="toggleStatus({{ employee.pk }})">
                                <i class="fas fa-user-times me-2"></i>Désactiver
                            </button>
                        {% else %}
                            <button class="btn btn-success" onclick="toggleStatus({{ employee.pk }})">
                                <i class="fas fa-user-check me-2"></i>Activer
                            </button>
                        {% endif %}
                        <a href="{% url 'accounts:employee_delete' employee.pk %}" class="btn btn-danger">
                            <i class="fas fa-trash me-2"></i>Supprimer
                        </a>
                    </div>
                </div>
            </div>

            <!-- Informations système -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-info-circle me-2"></i>Informations système
                    </h6>
                </div>
                <div class="card-body">
                    <div class="small text-gray-600">
                        <div class="d-flex justify-content-between mb-2">
                            <span>ID :</span>
                            <strong>#{{ employee.pk }}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Superutilisateur :</span>
                            <strong>{{ employee.is_superuser|yesno:"Oui,Non" }}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Staff :</span>
                            <strong>{{ employee.is_staff|yesno:"Oui,Non" }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleStatus(employeeId) {
    if (confirm('Êtes-vous sûr de vouloir changer le statut de cet employé ?')) {
        fetch(`/accounts/employees/${employeeId}/toggle-status/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.msg || 'Erreur lors du changement de statut');
            }
        })
        .catch(error => {
            console.error('Erreur:', error);
            alert('Erreur lors du changement de statut');
        });
    }
}
</script>

<style>
.text-gray-800 {
    color: #5a5c69 !important;
}
.text-gray-600 {
    color: #858796 !important;
}
.text-muted {
    color: #b7b9cc !important;
}
</style>
{% endblock %}